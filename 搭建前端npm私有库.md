# 搭建一个前端的npm的私有库

由于公司业务发展，将一个项目分成了不同的业务线，并且项目中有一些重复代码需要每次重复修改。所以需要一个集中所有公用部分的工程来达到修改一次的目的。私有库可以修改一次然后提高版本发包，其他工程对应的升级包来开发，自动化打包时需要设置打包的 npm 地址为私有仓库

## 前期调研

现在国内使用的主要有：
  - **cnpm：https://github.com/cnpm/cnpmjs.org**
  - **verdaccio：https://verdaccio.org/**

cnpm 的优势较大，但是配置项较多和需要依赖数据库等。verdaccio 不需要数据库只需要node环境就可以使用，缺点是一些复杂工作需要配置插件来实现。我司只有两名前端，并不需要很复杂的权限控制，因此采用 verdaccio 来实现自己的私有库。大于5人的团队，并且权限控制要求较高就可以用cnpm来实现。

## 具体搭建

服务器上装好 node 环境 然后按照文档一步步实现就好，因为内网环境，所以只设置了只允许注册两个账号来控制权限，每个人都有完全的权限。

## 出现问题

  1. 安装启动时，提示没有权限。修改 npm 包下载地址或者添加对应的用户权限
  2. 在启动时提示编译错误，因为前端服务器的机器的系统较老，gcc 版本也很老，因此需要升级 gcc 的版本。升级教程：https://www.cnblogs.com/kevingrace/p/9456563.html 编译会比较慢需要较多的时间。我开了多核编译，花了4个小时左右编译完成。
  3. 管理页面和npm发包等配置 nginx 代理之后出现问题，增加前置路径 如http://xxx.xxx.xxx.xxx/xy/ 可以解决问题。

## 使用中的问题 

npm 文档：https://docs.npmjs.com/
按照 npm 文档来使用，可以参考 Github 上著名的开源库来配置自己的私有库。其他登录、注册、发包，删除包，升级包都可以使用使用npm 文档来解决问题。

使用 pm2 来进行进程管理，实现监控。

将脚本将服务添加到开机启动文件中实现服务器重启后自动拉起服务。

使用公司的 gitlab 配置同步后自动发包（未实现）

## 其他方法

使用 docker 来搭建比较快速，但是需要挂载一个本地主机的目录，不然下次启动会导致前期工作丢失。